# MPU6050
## MPU6050简介
### 基本介绍
六轴传感器模块它采用 InvenSense 公司的 MPU6050 作为主芯片,能同时检测三轴加速度、三轴陀螺仪(三轴角速度)的运动数据以及温度数据。

利用DMP模块，可对传感器数据进行滤波、融合处理,直接通过 IIC 接口向主控器输出姿态解算后的数据,**降低主控器的运算量**。

### 模块应用场景
手机、智能手环、四轴飞行器、计步器等

### 特性参数
| 参数               | 说明                                       |
| ------------------ | ------------------------------------------ |
| 供电               | 3.3V-5V                                    |
| 通讯接口           | IIC，支持最高频率为400KHz                  |
| 测量维度           | 加速度：三维</br>陀螺仪：三维              |
| ADC分辨率          | 加速度16位</br>陀螺仪：16位                |
| 加速度测量范围     | ±2g、±4g、±8g、±16g g为重力加速度，9.8     |
| 加速度最高分辨率   | 16384 LSB/g                                |
| 加速度测量精度     | 0.1g                                       |
| 加速度输出率       | 最高1000Hz                                 |
| 陀螺仪测量范围     | ±250 o/s 、±500 o/s 、±1000 o/s、±2000 o/s |
| 陀螺仪最高分辨率   | 131 LSB/( o/s)                             |
| 陀螺仪测量精度     | 0.1                                        |
| 陀螺仪输出频率     | 最高 8000Hz                                |
| DMP 姿态解算频率   | 最高 200Hz                                 |
| 温度传感器测量范围 | -40~ +85°C                                 |
| 温度传感器分辨率   | 340 LSB/°C                                 |
| 温度传感器精度     | +-1                                        |
| 工作温度           | -40~ +85°C                                 |
| 功耗               | 500uA~3.9mA (工作电压 3.3V)                |

### 引脚参数
| 序号 | 引脚名称 | 说明                                                                    |
| ---- | -------- | ----------------------------------------------------------------------- |
| 1    | VCC      | 3.3/5V输入                                                              |
| 2    | GND      | 地线                                                                    |
| 3    | SCL      | I2C 从时钟信号线 SCL (模块上已接上拉电阻)                               |
| 4    | SDA      | I2C 从数据信号线 SDA (模块上已接上拉电阻)                               |
| 5    | XDA      | I2C 主串行数据信号线,用于外接传感器(模块上已接上拉电阻)                 |
| 6    | XCL      | I2C 主串行时钟信号线,用于外接传感器(模块上已接上拉电阻)                 |
| 7    | AD0      | 从机地址设置引脚</br>接地或者悬空地址为0x68</br>  接VCC 时,地址为:0x69 | 
| 8    | INT      | 中断输出引脚                                                            |

其中的 SDA/SCL、XDA/XCL 通讯引脚分别为两组 I2C 信号线。当模块与外部主机通讯时,使用 SDA/SCL,如与 STM32 芯片通讯;而 XDA/XCL 则用于 MPU6050 芯片与其它I2C 传感器通讯时使用,例如使用它与磁场传感器连接,MPU6050 模块可以把从主机SDA/SCL 接收的数据或命令通过 XDA/XCL 引脚转发到磁场传感器中。
`但是实际应用中这个功能比较鸡肋`

[[MPU6050_硬件原理图]]
### MPU6050初始化
第一步 初始化IIC接口
第二步 服务额uMPU6050 由电源管理寄存器1(0x6B)控制
第三步 设置角速度和加速度传感器的满量程范围
+ 由陀螺仪配置寄存器(0x1B)
+ 角加速度传感器配置寄存器(0x1C)设置

第四步 设置其他参数
+ 配置中断由中断使能寄存器(0x38)控制
+ 设置AUX IIC接口，由用户控制寄存器(0x6A)控制
+ 设置FIFO 有FIFO是能寄存器(0x23)控制
+ 陀螺仪采样率 由采样分频寄存器(0x19)控制
+ 设置数字低通滤波器，由配置寄存器(0x1A)控制

第五步 设置系统时钟
由电源管理寄存器1(0x6B)控制
`一般选择x轴PLL作为时钟源，以获得更高精度的时钟`
第六步 是能角速度传感器(陀螺仪)和加速度传感器
由电源管理寄存器2(0x6C)控制
初始化完成后就可以读取器件传感器的数据了

### 寄存器介绍
#### 电源管理寄存器(0x6B)
![[Pasted image 20210525114619.png]]
DEVICE_RESE = 1,复位MPU6050，复位完成后自动清零
SLEEP = 1，进入睡眠模式
SLEEP = 0，正常工作模式
TEMP_DIS,用于设置是否使能温度传感器，设置为0则使能
CLKSEL\[2:0],用于选择系统时钟源

| CLKSEL\[2:0] | 时钟源                             |
| ------------ | ---------------------------------- |
| 000          | 内部RC晶振                         |
| 001          | PLL，使用X轴陀螺仪作为参考         |
| 010          | PLL，使用Y轴陀螺仪作为参考         |
| 011          | PLL，使用Z轴陀螺仪作为参考         |
| 100          | PLL,使用外部32.768KHz作为参考      |
| 101          | PLL,使用外部19.2KHz作为参考        |
| 101          | 保留                               |
| 111          | 关闭时钟，保持时序产生电路复位状态 |

#### 陀螺仪配置寄存器(0x1B)
![[Pasted image 20210525115332.png]]
只关心FS_SEL\[1:0]这两个位，用于设置脱落一的满量程范围

| 值  | 满量程范围 |
| --- | ---------- |
| 0   | +-250      |
| 1   | +-500      |
| 2   | +-1000     |
| 3   | +-2000     |

#### 加速度传感器配置寄存器(0x1C)
![[Pasted image 20210525115647.png]]
只关心FS_SEL\[1:0]这两个位，用于设置脱落一的满量程范围
一般设置为0

| 值  | 加速度传感器满量程范围 |
| --- | ---------------------- |
| 0   | +-2g                   |
| 1   | +-4g                   |
| 2   | +-8g                   |
| 3   | +-16g                  |

#### FIFO使能寄存器(0x23)
![[Pasted image 20210525120018.png]]
用于控制FIFO使能，在简单读取传感器数据的时候，可以不用FIFO设置对应位为：0，既可以禁止FIFO，设置为1,则使能FIFO
加速度传感器的三个轴都是由这个位(ACCEL_FIFO_EN)控制的，只要该位置为1,则加速度传感器的三个通道都开启的FIFO

#### 陀螺仪采样率分频寄存器(0x19)
![[Pasted image 20210525120412.png]]
该寄存器用于设置MPU6050的陀螺仪采样率，计算公式为
$$采样率=陀螺仪输出频率/(1+SMPLRTDIV)$$
陀螺仪的输出频率是1KHz或者8KHz，与数字低通滤波器(DLPF)的设置有关
当DLPF_CFG=0/7的时候，频率为8KHz，其他情况是1KHz
而且DLPF滤波频率一般设置为采样率的一半
采样率假定设置为50Hz，则SMPLRT_DIV = 1000/50 -1 = 19

#### 配置寄存器(0x1A)
![[Pasted image 20210525121042.png]]
重点看数字滤波器(DLPF)的设置位，即DLPF_CFG\[2:0]，加速度计和陀螺仪，都是根据这三个位的配置进行过滤的
![[Pasted image 20210525121401.png]]
设置带宽=1/2采样率

#### 电源管理寄存器2(0x6C)
![[Pasted image 20210525121634.png]]
该寄存器的LP_WAKE_CTRL用于控制低功耗时的唤醒频率
剩下的6位分别控制加速度和陀螺仪的x、y、z轴是否进入待机模式
如果不用进入待机模式，则全部设置为0

#### 加速度传感器数据输出寄存器(0x3B-0x40)
![[Pasted image 20210525121858.png]]
加速度传感器数据输出寄存器共有6个寄存器组成，输出X、Y、Z三个周的加速度传感器的值
高字节在前，低字节在后

#### 陀螺仪数据输出寄存器(0x43-0x48)
![[Pasted image 20210525122108.png]]
陀螺仪传感器数据输出寄存器共有6个寄存器组成，输出X、Y、Z三个周的加速度传感器的值
高字节在前，低字节在后

#### 温度传感器数据输出寄存器(0x41-0x42)
![[Pasted image 20210525122254.png]]
通过读取0x41(高八位)和0x42(低八位)寄存器得到，温度转换公式为
$$Temperature = 36.53 + regval/340$$

[[MPU6050_程序]]
[[MPU6050_DMP使用介绍]]
[[MPU6050_DMP_API]]
[[MPU6050_DMP姿态解算]]
#IIC
