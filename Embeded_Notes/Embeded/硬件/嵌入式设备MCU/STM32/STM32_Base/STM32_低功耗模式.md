# 低功耗模式
STM32 本身支持低功耗模式
例如STM32F407支持三种低功耗模式
+ 睡眠模式(sleep)
+ 停止模式(stop)
+ 待机模式(standby)

三种模式对比如下：
![Pasted image 20210718052330](../../../../../pictures/Pasted%20image%2020210718052330.png)
这三种低功耗模式对应三种不同的功耗水平，根据实际的应用环境选择相对应的低功耗模式

## 睡眠模式
### 进入休眠模式
进入睡眠模式有两种指令：WFI(等待中断)和 WFE(等待事件)。根据 Cortex-M内核的 SCR(系统控制)寄存器可以选择使用立即休眠还是退出时休眠，当 SCR 寄存器的 SLEEPONEXIT(bit1)位为 0 的时候使用立即休眠，当为 1 的时候使用退出时休眠。

CMSIS(Cortex 微控制器软件接口标准)提供了两个函数来操作指令 WFI 和 WFE，我们可以直接使用这两个函数：\_\_WFI 和\_\_WFE。

### 退出休眠模式
如果使用 WFI 指令进入休眠模式的话那么任意一个中断都会将 MCU 从休眠模式中唤醒，如果使用 WFE 指令进入休眠模式的话那么当有事件发生的话就会退出休眠模式，比如配置一个EXIT线作为事件

STM32F429 处于休眠模式的时候 Cortex-M4F 内核停止运行，但是其他外设运行正常，比如 NVIC、SRAM 等。休眠模式的功耗比其他两个高，但是休眠模式没有唤醒延时，应用程序可以立即运行。

## 停止模式
停止模式基于 Cortex-M4F 的深度休眠模式与外设时钟门控，在此模式下 1.2V 域的所有时钟都会停止，PLL、HSI 和 HSE RC 振荡器会被禁止，但是内部 SRAM 的数据会被保留。调压器可以工作在正常模式，也可配置为低功耗模式。如果有必要的话可以通过将 PWR_CR 寄存器的 FPDS 位置 1 来使 Flash 在停止模式的时候进入掉电状态，当 Flash 处于掉电状态的时候 MCU 从停止模式唤醒以后需要更多的启动延时。
![Pasted image 20210718052729](../../../../../pictures/Pasted%20image%2020210718052729.png)


## 待机模式
相比于前面两种低功耗模式，待机模式的功耗最低。待机模式是基于 Cortex-M4F 的深度睡眠模式的，其中调压器被禁止。1.2V 域断电，PLL、HSI 振荡器和 HSE 振荡器也被关闭。除了备份区域和待机电路相关的寄存器外，SRAM 和其他寄存器的内容都将丢失。

![Pasted image 20210718052805](../../../../../pictures/Pasted%20image%2020210718052805.png)