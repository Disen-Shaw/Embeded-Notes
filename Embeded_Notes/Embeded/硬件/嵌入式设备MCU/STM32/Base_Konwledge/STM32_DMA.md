# DMA 简介
## DMA作用
直接访问(DMA)用于在外设与存储器之间以及存储器与存储器之间，提供高速数据传输。
可以在无需CPU操作的情况下通过DMA快速移动数据
用于节省CPU的资源

DMA就是CPU的助手、数据搬运工

DMA独立于AHB总线，是一个独立的外设
H7会比较复杂

对于DMA这个外设，它的功能就是建立起一个数据传输通道
### DMA通道
有7个通道
+ Memory->Memory
+ Memory->Peripherial
+ Peripherial->Memory

特定的外设对应特定的通道

DMA2有5个通道
一般来说DMA只存在于大容量和互联型的芯片中

### 多个DMA同时使用时优先级划分
1. 软件阶段，看DMA寄存器CRRx的PL\[ 1 0 ]位
2. 硬件阶段，通道编号小的优先级大


### FIFO
对于高级芯片的FIFO用于在源数据传输到目标之前临时存储这些数据，通过不同的FIFO配置，可以管理数据发送形式

## DMA执行流程
### 建立(选取)传输通道
+ 存储器->存储器
+ 外设->存储器
+ 存储器->外设

### 确定传输对象
具体实例
UART->内存
内存数据->UART

### 传输细节
#### 确定由谁来产生DMA请求
例如：
UART->内存 由串口产生
内存数据->UART 由内存中的数据产生

#### 优先级
DMA数据运输不是并行的，而是串行的
DMA传输有优先级的顺序
+ 低通道的优先级高于高通道的
+ DMA1的优先级高于DMA2

#### 确定传输数据双方的数据格式
+ 大端对其
+ 小端对其等

#### 循环传输
确定数据是否需要一直采集(循环是否使能)
+ 一般传输
+ 循环传输

#### 是否需要传输标志/中断
确定是否需要DMA的终端功能

#### 外设请求对应的通道
对应前面的通道

## DMA不同型号差异
![[Pasted image 20210607015014.png]]
### 双缓冲模式
DMA先填充一个缓冲区域，完事之后去填充第二个缓冲区域
此时CPU就可以对第一个区域的数据进行处理，反复套娃

### FIFO
可以用于临时缓冲数据，做一些数据的处理工作
可以用于源数据和目标数据宽度不同的时候使用
通过过FIFO对要传输的数据进行一个封装，将字节封装成字、半字。或者将半字封装成字

### 单次传输和突发传输
当AHB外设端口设置为单次传输时，每个DMA请求只产生一次字节、半字或者字的数据传输
当AHB外设端口设置为突发传输时，每个DMA请求相应生成4个、8个或16个节拍的字节、半字或字的传输
![[Pasted image 20210607020250.png]]

地址递增取决与数据的宽度
[[STM32_DMA编程]]