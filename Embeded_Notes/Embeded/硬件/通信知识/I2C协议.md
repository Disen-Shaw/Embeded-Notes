# I2C协议
引脚少、不需要USART、CAN等通讯协议的外部收发设备

## I2C物理层特点

+ 支持多设备连接的总线
+ 一个I2C总线只使用两条总线线路
+ 每个连接到总线的设备都有一个独立的地址
+ 总线通过上拉电阻接到电源
  + I2C设备空闲时，会输出高阻态，由上拉电阻把总线拉成高电平
  + 输出逻辑1时通过高阻态表示，此时通过上拉电阻的高电平表达逻辑1N
  + 高阻态类似于直接断开
+ 多个主机同时使用总线，为防止冲突，会利用仲裁方式决定那个设备占用总线
+ 具有三种传输模式：多数I2C设备不支持高速
  + 标准模式：100k bit/s
  + 快速模式：400k bit/s
  + 高速模式：3.4M bit/s
+ 连接到相同的IC数量受到总线的最大电容限制

设置为开漏输出

## I2C协议层特点
I2C协议层规定了通讯的起始信号和停止信号、数据的有效性、响应仲裁、时钟同步和地址广播等环节

**I2C基本读写过程**

1. 主机写数据到从机


![[Pasted image 20210309171003.png]]

2. 主机从从机中读取数据

![[Pasted image 20210309171053.png]]

3. I2C复合通讯


![[Pasted image 20210309171116.png]]

+ S：传输开始信号 下降沿
+ SLAVE ADDRESS：从机地址
+ DATA：数据位
+ R/W#：读、写信号
+ A/A#：应答或者飞应答信号
+ P：停止位 上升沿
+ SCL为高电平时SDA数据有效，此时SDA高电平为数据1,低电平为数据0
+ SCL作为低电平时，SDA的数据无效，SDA进行电平切换，为下一次数据做好准备

4. 地址及数据方向

+ I2C总线的每个设备都有自己的地址，朱局发送通讯时，通过SDA信号发送设备地址来查找从机，设备地址可以是7位或者10位
+ 地址后面的一个数据位**R/W#**来表示数据的传输方向

 | MSB       |           |           |           |           |           |           | LSB  |
     | --------- | --------- | --------- | --------- | --------- | --------- | --------- | ---- |
     | 从机地址1 | 从机地址2 | 从机地址3 | 从机地址4 | 从机地址5 | 从机地址6 | 从机地址7 | R/W# |

通信到相应的地址后，硬件自动配对响应
5. 响应

   I2C数据或者地址的传输都带响应

   + 应答
   + 非应答

 传输时主机产生时钟，**在第九个时钟时，数据发送端会释放SDA的控制权，**由数据接收端控制SDA

   + **若SDA为高电平，表示非应答**
   + **若SDA位低电平，表示应答**



