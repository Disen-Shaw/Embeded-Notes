# 四轴飞行器飞行控制原理
## 四轴姿态控制原理
对于飞行的控制来源于四个旋翼的转速，通过分别控制四个旋翼的转速即可实现不同的姿态。
四轴飞行器在空间上有六个自由度，分别沿三位坐标轴的平动和转动
二者六个自由度可以通过调节不同旋翼的转速来实现
**六个自由度**分别是:
+ 垂直升降
+ 俯仰角度
+ 横滚角度
+ 偏行角度
+ 前后飞行
+ 左右侧向飞行

四周飞行器结构可以分为"X"型和"十"型，不同的结构类型对应着不同的控制方法

升降运动或俯仰运动和前后运动
![Pasted image 20210521162945](../../../../pictures/Pasted%20image%2020210521162945.png)

横滚角度或者左右运动和偏行角度
![Pasted image 20210521163033.png](Pasted%20image%2020210521163033.png)

## PID控制
![Pasted image 20210522144505](../../../../pictures/Pasted%20image%2020210522144505.png)
姿态通过一系列的转化最终给量化成三个角度分别为
+ 俯仰角
+ 横滚角
+ 行向角

用这三个角度来描述四轴在空间的姿态

### 四轴姿态单级PID控制
由于姿态角有三个，所以一个PID控制器是不能达到控制四轴飞行器姿态和运动的，至少需要三个PID控制器

![Pasted image 20210522144909](../../../../pictures/Pasted%20image%2020210522144909.png)

要求方发来姿态角，作为期望角度输入到控制系统中与姿态结算算法结算出实际姿态角进行求取偏差，分别经过各自的PID控制器进行PID运算，运算结果转化为PWM方波来调节四个点击的转速，从而调节四周飞行器的姿态运动

调节后的姿态叫又通过姿态反馈环反馈为下一次控制做准备

调节时不稳定，迟钝，可能会失控

### 四轴姿态串级PID控制
螺旋桨的转速与升力不成正比，而是平方倍关系，导致四轴飞行器输入与输出量不再是线性关系，而是呈现平方倍的关系

采用双闭环串级PID控制，既对角度进行PID控制，又对角速度进行PID控制
由于角度的微分就是角速度，所以角度环的误差就可以理解成角速度，把角度环的误差作为角速度换的期望值输入到角速度环，角速度环用陀螺仪来观测叫速度的变化作为反馈之与期望值求取误差，然后控制角度尽快打带期望值，叫速度环的输出值给四路电机，控制飞机的姿态，姿态结算算法获取实时姿态作为角度环的反馈值
用以上方法将两个PID控制器串联在一起

![Pasted image 20210522153127](../../../../pictures/Pasted%20image%2020210522153127.png)

双闭环串级PID控制比单闭环PID控制，多了一个角速度环的控制，角速度的数据是陀螺仪测出来的，测量值一般不容易受到干扰，并且角速度变化较快，当受到外界干扰时反应迅速，增强了系统的稳定性，解决了单级PID控制时打大舵量遥控时会出现非习惯起失衡或者跟随滞后的问题

![Pasted image 20210729052245](../../../../pictures/Pasted%20image%2020210729052245.png)
32</br>01
$$M1=Moter[0]=(int16_t)(Thr+Pitch+Roll-Yaw)$$
$$M2=Moter[1]=(int16_t)(Thr+Pitch-Roll+Yaw)$$
$$M3=Moter[2]=(int16_t)(Thr-Pitch-Roll-Yaw)$$
$$M4=Moter[3]=(int16_t)(Thr-Pitch+Roll+Yaw)$$

