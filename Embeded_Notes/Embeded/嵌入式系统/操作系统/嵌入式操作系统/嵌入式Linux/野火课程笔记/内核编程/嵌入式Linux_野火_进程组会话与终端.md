# 进程组、会话和终端

## 进程组

对相同类型的进程进行管理

### 进程组的诞生

- 在 [Shell](../../../../../../语言和脚本/脚本/Shell/Shell_Source.md) 里直接执行一个应用程序
  - 对于大部分进程来说，自己就是进程组的首进程
  - 进程组只有一个进程
- 如果 进程调用了 [fork](嵌入式Linux_野火_进程#创建进程) 函数父子进程同属于一个进程组，父进程为首进程
- 在 [Shell](../../../../../../语言和脚本/脚本/Shell/Shell_Source.md) 中通过管道执行连接起来的应用程序，两个进程同属于一个进程组
  - 第一个程序为进程组的首进程

进程组 ID：PGID，由首进程 PID 决定

通过 `ps axjf` 查看进程组 ID

## 会话

对进程组进行管理

### 会话的诞生

- 调用 `setid` 函数新建一个会话，应用程序作为会话的第一个进程，称为会话首进程
- 用户在终端正确登陆之后，启动 [Shell](../../../../../../语言和脚本/脚本/Shell/Shell_Source.md) 时，Linux系统会创建一个新的会话，shell进程 作为 会话 的 首进程

会话ID：会话首进程id，SID

### 前台进程组

[Shell](../../../../../../语言和脚本/脚本/Shell/Shell_Source.md)进程 启动时，默认是前台进程组的首进程\
前台进程组的首进程会占用会话所关联的终端来运行，shell 启动其他程序时，其他程序成为首进程

### 后台进程组

后台进程组中的进程是不会占用终端，在 shell 进程里启动时，在进程后面加上 `&` 可以指定进程在后台进程组中运行

`ctrl+z` 可以让会让进程进入后台，同时停止运行\
`jobs` 查看有哪些后台进程组\
`fg+job id` 可以将后台进程组切换为前台进程组

## 终端

### 物理终端

- 串口终端
- LCD 终端

### 伪终端

- SSH 远程连接产生的终端
- 桌面系统中的终端

### 虚拟终端

Linux 内核自带的虚拟终端，使用 `ctrl+alt+f1~6` 进入不同的虚拟终端

## 守护进程

会话用来管理前后台进程组，会话一般关联着一个终端\
当终端被关闭之后，会话中的所有进程都会被关掉

### 守护进程

不受终端影响，就算终端退出，也可以继续在后台运行

### 写守护进程

1. 创建一个子进程，父进程直接退出
   - 通过 `fork()` 函数
2. 在子进程中创建一个新的会话，摆脱终端影响
   - 通过 `setid()` 函数
3. 改变守护进程当前的工作目录，改为 `/`，避免占用文件
   - 通过 `chrdir()` 函数
4. 重设文件权限掩码
   - 新建文件默认执行权限：666
   - 通过 `umask()` 函数
5. 关闭不需要的文件描述符
   - 0,1,2 分别表示 标准输入，输出，错误
   - 通过 `close()` 函数

