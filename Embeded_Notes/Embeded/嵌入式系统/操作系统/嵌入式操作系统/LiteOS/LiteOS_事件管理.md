# LiteOS 事件管理 
## 基本概念
事件（Event）是一种任务间通信的机制，可用于任务间的同步。  
多任务环境下，任务之间往往需要同步操作，一个等待即是一个同步。事件可以提供一对多、多对多的同步操作。

+ 一对多同步类型：一个任务等待多个事件触发可以时任意一个时间发生时唤醒任务处理事件，也可以是多几个事件都发生后才唤醒处理事件
+ 多对多同步模型：多个任务等待多个事件的触发

### LiteOS提供的事件特点

+ 任务通过创建事件控制块来触发事件或等待事件
+ 事件间相互独立
	+ 内部实现为一个32位无符号整型，每一位标识一种事件类型。
	+ 第25位不可用，因此最多可支持31种事件类型
+ 事件仅用于任务间的同步，不提供数据传输功能
+ 多次向事件控制块写入同一事件类型，在被清零前等效于只写入一次
+ 多个任务可以对同一事件进行读写操作
+ 支持事件读写超时机制

### 事件控制块
```c
typedef struct tagEvent {

    UINT32 uwEventID;            /* 事件ID，每一位标识一种事件类型 */
    LOS_DL_LIST    stEventList;  /* 读取事件的任务链表 */
} EVENT_CB_S, *PEVENT_CB_S;
```

uwEventID：
+ 用于标识该任务发生的事件类型
+ 其中每一位表示一种事件类型（0表示该事件类型未发生、1表示该事件类型已经发生）
+ 一共31种事件类型，第25位系统保留

### 事件读取模式
在读事件时，可以选择读取模式
+ 所有事件(`LOS_WAITMODE_AND`)：
	+ 逻辑与，基于接口传入的事件类型掩码 `eventMask`
	+ 只有这些事件都已经发生才能读取成功，否则该任务将阻塞等待或者返回错误码
+ 任意事件(`LOS_WAITMODE_OR`)：
	+ 逻辑或，基于接口传入的事件类型掩码 `eventMask`
	+ 只要这些事件中有任一种事件发生就可以读取成功，否则该任务将阻塞等待或者返回错误码
+ 清除事件(`LOS_WAITMODE_CLR`)：
	+ 一种附加读取模式，需要与所有事件模式或任一事件模式结合使用
	+ （LOS_WAITMODE_AND | LOS_WAITMODE_CLR或 LOS_WAITMODE_OR | LOS_WAITMODE_CLR）
	+ 在这种模式下，当设置的所有事件模式或任一事件模式读取成功后，会自动清除事件控制块中对应的事件类型位。

## 运作机制
任务在调用 `LOS_EventRead` 接口读事件时，可以根据入参事件掩码类型 `eventMask` 读取事件的单个或者多个事件类型  
事件读取成功后，如果设置 `LOS_WAITMODE_CLR` 会清除已读取到的事件类型，反之不会清除已读到的事件类型，需显式清除  
可以通过入参选择读取模式，读取事件掩码类型中所有事件还是读取事件掩码类型中任意事件。

任务在调用 `LOS_EventWrite` 接口写事件时，对指定事件控制块写入指定的事件类型，可以一次同时写多个事件类型  
**写事件会触发任务调度**

任务在调用 LOS_EventClear 接口事件时，根据入参事件和待清除的事件类型，对事件进行清0操作

![[Pasted image 20210907141543.png]]

[[LiteOS_事件管理_API]]
