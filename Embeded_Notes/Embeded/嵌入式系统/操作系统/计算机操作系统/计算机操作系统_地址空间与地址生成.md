---
date updated: '2021-10-03T09:14:52+08:00'

---

# 地址空间与地址生成

## 地址空间定义

### 物理地址空间

与硬件直接对应，例如内存条和硬盘
管理和控制由硬件完成

### 逻辑地址空间

运行的程序看到的地址空间，一维线性地址空间

## 地址生成

### 逻辑地址的生成

以C语言为例
![Pasted image 20210605134627](../../../../pictures/Pasted%20image%2020210605134627.png)
C语言文件`.c`编译后生成汇编语言`.s`，汇编语言由汇编器汇编成机器语言`.o`文件，再由linker，将多个`.o`程序变为单一的可执行程序，存放在硬盘中
在使用程序时通过loader从硬盘中载入程序到内存中，进行一定的内存分配，使程序可以在内存中正常的跑

想对于loader而言，其地址有一定的偏移量，有了这个偏移量，程序就可以对这个内存进行正确的内存访问

## 逻辑地址与对应的物理空间

![Pasted image 20210605135818](../../../../pictures/Pasted%20image%2020210605135818.png)

总体步骤：
第一步：当CPU要执行某条指令的时候，它的ALU(计算逻辑单元)部件发送需要这条指令的内容的请求，发出请求带的参数就是逻辑地址。
第二步：CPU中的MMU会查找逻辑地址的映射表中是否存这条逻辑地址，如果MMU中没有找到这样的映射，就会产生一个处理过程，到内存中的Map中查找
找到之后会发送对应物理地址的请求，来读取这部分内存的数据或者程序
第三步：主存通过总线将逻辑地址对应的内容传给CPU，cpu拿到指令之后就可以对其执行

这个步骤操作系统的作用:
在完成这几步之前把映射关系建立好

### CPU方面

运算器需要在逻辑地址的内存内容
内存管理单元寻找在逻辑地址和物理地址之间的映射
控制器从总线发送在物理地址的内存内容的请求

CPU中有一块MMU，MMU中的一块区域表示了指令与存储器中的地址的映射关系
这个映射关系完成了逻辑地址到物理地址的映射

### 内存方面

内存发送物理地址内存的内容给CPU

### 操作系统方面

建立逻辑地址和物理地址之间的映射

## 地址安全检测

操作系统要确保每一个程序有效访问的地址空间(包含起始地址和长度)，这个区域是允许这个程序合理访问的，一旦超出这篇区域，这个访问就是一个不合法的访问
`这个内存表也是操作系统来建立和维护的`
一旦CPU要执行某条指令，就会查询这个表，指出某一条逻辑地址，并判断是否满足长度限制，如果成功，则通过这段逻辑地址找到对应的物理地址，并将数据读取过来
一旦不满足，CPU就会产生一个内存访问异常，从而让操作系统进一步处理。
