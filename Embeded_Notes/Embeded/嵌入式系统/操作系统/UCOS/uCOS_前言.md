# uCOS基础
## 前后台系统和RTOS
### 前后台系统
早期嵌入式开发没有`嵌入式操作系统`的概念，直接操作裸机，在裸机上写程序，例如51单片机基本都没有操作系统
通常把程序分为两部分：
+ 前台系统
+ 后台系统

简单的小程序通常是前后台系统，包括一个死循环和若干个中断服务程序
应用程序是一个无限循环，循环中调用API函数完成所需要的操作
这个`大循环`叫做后台系统
中断服务程序用于处理系统的异步事件，也就是前台系统
前台是中断级，后台是任务级

### RTOS系统
RTOS全称(Real Time OS)，实时操作系统，强调的是`实时性`
实时操作系统又分为`软实时`和`硬实时`

`软实时`要求超时要求没那么严格
`硬实时`要求在规定时间内不许完成操作，不允许超时

在实时操作系统中，可以把要实现的功能划分为多个任务，每个任务负责实现其中的一部分，每个任务都是一个简单的程序，通常是一个死循环
RTOS作系统的核心在于：实时内核

RTOS的内核负责管理所有的任务，内核决定了运行哪个任务，何时停止当前任务切换到其他的任务，这个是内核的`多任务管理能力`
多任务给人的感觉是芯片有多个CPU，实现CPU的资源最大化利用
多任务有助于实时程序的`模块化开发`，能够实现复杂的实时应用

#### RTOS操作系统
+ uCOS
+ FreeRTOS
+ RTX
+ RT-Thread
+ DJYOS等

#### 如何学习
+ 查看API的使用说明
+ 阅读RTOS的源码

### 可剥夺内核
可以剥夺其他任务的CPU使用权，它总是运行就绪任务中优先级最高的任务


## uCOS
Micrium公司出品的RTOS类实时操作系统，目前有两个版本
+ uCOSII
+ uCOSIII

uCOSIII是一个可裁剪、可剥夺型的多任务内核，而且没有任务数量限制，提供了实时操作系统所需要的所有功能，包括资源管理、同步、任务通信等，采用C和汇编编写，大部分C，小部分与处理器相关的用汇编
`网上资料很多，资料满天飞`
### uCOS资料查找
+ [Micrium官网](https://www.micrium.com)
+ [开源电子网](http://www.openedv.com)
+ 其他论坛


### uCOS移植步骤
1. 在基础工程中添加相应的文件夹
	+ CONFIG
	+ CORE
	+ PORT
2. 向CORE文件夹添加uCOS所有源码
3. 向CONFIG文件夹添加文件
	+ includes.h
	+ os_cfg.h
4. 向PORT文件夹下添加文件
	+ os_cpu.h
	+ os_cpu_a.asm
	+ os_cpu_c.c
	+ os_dbg.c
	+ os_dbg_r.c
5. 将源码添加到工程中
工程中新建三个文件夹，分别为CORE、PORT、CONFIG，分别添加源码,**添加CORE不可以将ucos-II.c添加进去**),并添加头文件路径，错改错，PendSV应保留汇编中的文件

F4之后的系列CPU带有FPU浮点运算单元，应加上宏定义
\_\_FPU\_USED=1

### 测试
设计要求

创建一个start_task任务，Start任务用来创建其他任务
创建一个led0_task任务，用来控制LED0的亮灭
创建一个led1_task任务，用来控制LED1的亮灭
创建一个float_task任务，用来测试浮点运算


## uCOS体系结构
CORE文件夹内的文件源码与CPU无关，不管什么CPU用的都是这些源码
CONFIG文件夹内的文件是配置文件，定义了要实现怎样的功能，内核裁剪等
移植时要修改的文件只是os_cpu.h，os_cpu_a.asm，os_cpu_c.c，这些文件与CPU有关