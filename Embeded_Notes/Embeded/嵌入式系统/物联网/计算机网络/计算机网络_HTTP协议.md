# HTTP协议
## HTTP协议
超文本传输协议
### 体系结构

服务器、客户机模式 C/S结构
+ 客户——Browser：请求、接受、展示Web对象
+ 服务器——Web Server:响应客户的请求，发送对象
+ Apache

### HTTP版本
+ 1.0:RFC 1945
+ 1.1:RFC 2068

### 使用TCP传输协议
+ 服务器在80端口等待客户的请求
+ 浏览器发起到服务器的TCP链接(创建套接字Socket)
+ 服务器接受来自浏览器的TCP连接
+ 服务器(HTTP客户端)与Web服务器(HTTP服务器)交换HTTP消息
+ 关闭TCP连接

### 无状态协议
+ 服务器不维护任何有关客户端过期发送请求的信息

#### 有状态的协议更复杂
+ 需要维护状态(历史信息)
+ 如果客户或服务器失效，会产生状态的不一致，解决这种不一致代价高


### HTTP连接
#### HTTP连接的两种类型

| 非持久性连接(Nonpersistent HTTTP | 持久性连接(Persistent HTTP)     |
| -------------------------------- | ------------------------------- |
| 每个TCP连接最多允许传输一个对象  | 每个TCP连接允许传输**多个**对象 |
| HTTP 1.0版本使用非持久性连接     | HTTP1.1版本默认使用持久性连接   |

#### 具体连接过程
##### 非持久性连接
假定在浏览器中输入URL:www.someSchool.edu/something/home.index  
HTTP客户端向地址为www.someSchool.edu的服务器上的HTTP服务器进程发起TCP连接请求  
HTTP服务器在端口80等待TCP连接请求，接受连接病通知客户端  
HTTP客户端将HTTP请求消息(包含URL地址)通过TCP连接的套接字发出，消息中包含的URL表明客户端需要的对象something/home.index  
HTTP服务器收到请求消息，解析，产生包含所需要对象的响应消息，并通过套接字发给客户端  
something/home.index  
**HTTP服务器关闭TCP连接**  
HTTP客户端收到相应消息，解析HTTP文件，显示HTML文件，发现10个指向jpeg的超链接  
为每个jpeg对象重复步骤1-5  

##### 响应时间的分析与建模
+ RTT
	+ 从客户端发送一个很小的数据包到服务器病返回所经历的时间
+ 响应时间
	+ 发起、建立TCP连接：1个RTT
	+ 发送HTTP请求消息到HTTP相应消息的前几个字节到达：1个RTT
	+ 响应消息中所含的文件/对象传输时间
	+ 总时间=2RTT+文件发送时间

##### 持久性HTTP
+ 非持久性连接的问题
	+ 每个对象需要两个RTT
	+ 操作系统需要为每个tcp开销资源
	+ 浏览器会打开多个并行的TCP连接以获取网页所需对象
	+ 给服务器造成较大的负担

+ 持久性连接
	+ 发送响应后，服务器保持TCP连接的打开
	+ 后续的HTTP消息可以通过这个连接发送

+ 无流水的持久性连接
	+ 客户端只有收到前一个响应之后才发送新的请求
	+ 每个被引用的对象耗时1个RTT

+ 带流水机制的持久性连接
	+ HTTP1.1的默认选项
	+ 客户端遇到一个引用对象就尽快发出请求
	+ 理想情况下，收到所有的引用对象只需要耗时约1个RTT
## HTTP消息格式
HTTP协议有两类消息
+ 请求消息(request)
+ 响应消息(response)

请求消息：
ASCII写的，人可以直接读
![[Pasted image 20210531004733.png]]
第一行 请求行
第一部分时请求的命令
第二部分是URL
第三部分是HTTP的版本

下面的几行为头部行
第一部分是主机名
第二部分是浏览器以及版本
第三部分是连接命令(本案例是关闭)
第四部分是支持的语言
第五部分空行 表示消息结束

## HTTP请求消息
### HTTP请求消息通用格式
![[Pasted image 20210531005056.png]]
CR是换行
请求消息携带数据->用户名密码等，向服务器发数据


### HTTP方法的类型
#### HTTP/1.0
+ GET 	从服务端申请获取数据
+ POST	向服务端发送数据
+ HEAD	请Server不要将所有请求的对象放入响应消息中
	+ 常用来做测试，只返回头部的信息，不返回对象

#### HTTP/1.1
+ GET、POST、HEAD
+ PUT
	+ 将消息体中的文件上传到URL字段所指定的路径
+ DELETE
	+ 删除URL字段所指的文件

#### POST方法
+ 网页经常需要填写的表格(form)
+ 请求消息的消息体(entity body)中上传客户端的消息

#### URL方法
+ 使用GET方法
+ 输入信息通过request行的URL字段上传


## HTTP响应消息
![[Pasted image 20210531010321.png]]
第一行是状态行 使用的HTTP版本、返回的状态码、状态码的解释
第二行是一样的
第三行Date是 Web服务器生成响应消息的时间
第四行服务器软件 Apache
第五行是上次修改时间
第六行内容的长度
第七行是内容的类型
空行

数据对象

### HTTP响应状态码
位于响应消息的第一行

| Code | Mean                       |
| ---- | -------------------------- |
| 200  | OK                         |
| 301  | Moved Permanently          |
| 400  | Bad Request                |
| 404  | Not Found                  |
| 505  | HTTP Version Not Supported |

301:永久性移走了



