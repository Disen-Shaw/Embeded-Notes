# 应用层
应用层位于协议栈的最上层

**网络应用与单机应用的本质性的区别？**
+ 有一定的基础硬件环境，
+ 一部分软件跑在客户机上，一部分软件跑在服务器上
+ 互相交互构成网络应用

## 网络应用的体系结构
### 客户机/服务器（Cinent-Server,CS）
![Pasted image 20210509015710](../../../../pictures/Pasted%20image%2020210509015710.png)
**服务器**
+ 7*24小时提供服务
+ 永久性的访问地址/域名
+ 能够同时处理大量用户的并发请求，利用大量服务器实现可拓展性

**客户机**
+ 与服务器进行通信，使用服务器的服务
+ 间歇性接入网络
+ 可能使用动态IP
+ 不会与其他客户机直接通信

例如Web
![Pasted image 20210509020234](../../../../pictures/Pasted%20image%2020210509020234.png)

### P2P(Peer-to-peer,P2P)
![Pasted image 20210509020334](../../../../pictures/Pasted%20image%2020210509020334.png)
+ 没有永远在线的服务器
+ 任意端系统/节点之间可以直接通讯
+ 节点间歇性接入网络
+ 节点可能改变IP地址

日常生活中较多的是文件共享
**与CS的区别**
优点：高度可伸缩性
缺点：难于管理

### 混合结构(Hybrid)
考虑情况，能否将两种结构混合在一起使用，利用两者的优点同事规避两者的缺点
#### Naster
![Pasted image 20210509021033](../../../../pictures/Pasted%20image%2020210509021033.png)
+ 文件的传输使用P2P结构
+ 文件的搜索采用C/S结构——集中式
	+ 每个节点向中央服务器登记自己的内容
	+ 每个节点向中央服务器提交查询请求，查找感兴趣的内容

## 网络应用进程通信
### 进程
+ 主机上运行的程序

客户机进程：发起通信的进程
服务器进程：等待通信请求的进程

### 同一主机运行的进程通信
**进程间通信机制**
操作系统提供

#### 套接字：Socket 网络的API
由操作系统提供出来的网络API接口
![Pasted image 20210509022311](../../../../pictures/Pasted%20image%2020210509022311.png)
进程间通信利用socket发送和接受消息实现
类似于寄信
+ 发送方将消息送到门外邮箱
+ 发送方依赖(门外的)传输基础设施将消息传到接收方所在的主机，并送到接收方门外
+ 接收方从门外获取信息

传输基础设施向进程提供API
+ 传输协议的选择
+ 参数的设置

### 不同主机上运行的进程间通信方式
消息交换
#### 寻址进程方式
不同主机上的进程间通信，每个进程必须拥有标识符
寻址主机的方式：IP地址
主机上不同进程划分：端口号
+ 为主机每个需要通信的进程分配一个端口号
+ HTTP Server:80
+ Mail Server:25

**进程的标识符：IP地址+端口号**

### 应用层进程协议
#### **网络应用需要遵循应用层协议**
公开协议：
+ 由RFC(Request For Comments)定义——[RFC文档](http://www.cnpaf.net/class/rfcall/)
+ 允许互操作，通用标准化
+ HTTP、SMTP，……

私有协议
+ 多数P2P文件共享应用

#### 应用层协议的内容
![Pasted image 20210509025007](../../../../pictures/Pasted%20image%2020210509025007.png)
消息的类型(例如HTTP协议)
+ 请求消息
+ 响应消息

消息的语法(syntax)/格式
+ 消息中有哪些字段
+ 每个字段是如何描述的

字段的语义(semantics)
+ 字段中信息的含义

规则(rules)
+ 进程何时发送/响应消息
+ 进程如何发送/响应消息

## 网络应用的需求与传输层的服务
### 网络应用对传输服务的需求
#### 数据丢失和可靠性的要求
某些网络应用能够容忍一定的数据丢失:网络电话
某些网络要求100%可靠地传输:文件传输、telnet
#### 时间/时延方面的要求
某些应用只有在延迟足够低时才能"有效"
例如网络电话、网络游戏
#### 带宽的要求
有些应用只有在带宽达到最低要求时才有效：网络视频
某些应用能够适应任何带宽：email

#### 典型网络应用对传输服务的需求
|应用类型|数据丢失|带宽要求|时延|
|-------|------|-------|----|
|文件翻译|不可以|基本没有|不可以|
|e-mail|不可以|基本没有|不可以|
|网络文献|不可以|基本没有|不可以|
|实时视频/音频|容忍|音频：5kbps-1Mbps</br>视频：10kbps-5mbps|100ms以内|
|存储音频/视频|容忍|音频：5kbps-1Mbps</br>视频：10kbps-5mbps|100ms以内|几秒内|
|网络游戏|容忍|几kbps以上|100ms以内|
|即时通讯|不可以|基本没有|都可以|

### Internet提供的传输服务

|TCP服务 | UDP服务|
|------|---------|
|面向连接：客户机/服务器进程间需要建立连接|无连接|
|可靠的传输|不可靠的数据传输|
|流量控制：发送方不会发送速度过快，超过接收方的处理能力|不提供流量控制|
|拥塞控制：当网络负载过重时能够限制发送方的发送速度|不提供拥塞控制|
|不提供时间/延迟保障|不提供延迟保障|
|不提供最小带宽保障|不提供带宽保障|

UDP服务更加自由
#### 典型网络应用所使用的传输层服务
![Pasted image 20210509032600](../../../../pictures/Pasted%20image%2020210509032600.png)






