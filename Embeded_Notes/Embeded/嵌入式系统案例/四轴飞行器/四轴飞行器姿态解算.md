# 四轴飞行器姿态解算
## 四元数、欧拉角、方向余弦矩阵在姿态解算中的使用
姿态角由旋转产生，一般旋转有4种表示方式
方向余弦矩阵表示、欧拉角表示、轴角表示、四元数表示
方向余弦矩阵适合变换方向
欧拉角最直观
轴角表示适合集合推导
组合旋转方面四元数最适合

![[Pasted image 20210318152657.png]]


## Mahony互补滤波算法分析
定理：
空间中坐标系的任意旋转，等效于一次绕三个坐标轴的定轴旋转
![[Pasted image 20210318153105.png]]
`类似于受力分析，坐标正交分解`

****
以绕Zn轴为例，推导旋转过程中坐标的变化
![[Pasted image 20210318153633.png]]
逆时针旋转a角，从坐标X1OY1旋转到X2OY2
空间矢量r在坐标1内的投影为[rx1,ry1,rz1]，在坐标2内的投影为[rx2,ry2,rz2]
推导出两组坐标系值间的关系。

由于绕OZ轴进行旋转，所以Z的坐标不变，rz1=rz2
![[Pasted image 20210318154439.png]]

将上面三个式子写成矩阵形式
`(Rx1)`
![[Pasted image 20210318154613.png]]
整理一下：
![[Pasted image 20210318154713.png]]
这样就用有欧拉角a组成的C1^2描述了这次旋转

![[Pasted image 20210318154926.png]]
![[Pasted image 20210318155012.png]]
![[Pasted image 20210318155019.png]]
****

这个Cn^b就是方向预先矩阵，描述了b系相对于n系的旋转
**知道任意向量在b系中的坐标，就可以利用方向余弦矩阵确定它在n系中的坐标，反之一样**

使用余姚套用欧拉角的微分方程，但是由于欧拉角微分方程含有大量的三角运算，这给实时解算带来了一定的困难
欧拉角只适用于水平姿态变化不大的情况，而适用于全姿态飞行器的姿态确定

![[Pasted image 20210318160759.png]]

矩阵Cb^n可以讲b系的向量转换到n系表示
矩阵Cn^b可以讲n系的向量转换到b系表示

## 四元数描述的方向余弦矩阵
![[Pasted image 20210318161148.png]]
其中q0,q1,q2,q3是实数i，j，k既是互相正交的单位向量，又是虚单位根号下-1

![[Pasted image 20210318161913.png]]

![[Pasted image 20210318162019.png]]
![[Pasted image 20210318162118.png]]

![[Pasted image 20210318162243.png]]
![[Pasted image 20210318162806.png]]

![[Pasted image 20210318183311.png]]