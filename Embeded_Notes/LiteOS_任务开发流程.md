# LiteOS任务开发流程
## 配置过程
**配置内核任务模块**  
通过 `make menuconfig` 配置任务模块，菜单路径为：Kernel-->Basic Config-->Task

界面如下所示
![[Pasted image 20210903212258.png]]

内核具体的配置宏如 [[LiteOS_任务API]] 中的 任务内核配置项 

**锁任务调度LOS_TaskLock()**  
防止高优先级的任务调度

**创建任务LOS_Create()**  
也可以静态创建任务

**解锁任务LOS_TaskUnlock()**  
让任务按照优先级进行调度

**其余可根据[[LiteOS_任务API]]中的API对任务进行编辑**

> 这部分无平台差异性，所有平台都适用

## 使用注意事项
+ 执行IDLE任务时，会对之前一删除的任务控制块和任务栈进行回收
+ 任务名是指针，并没有分配空间，在设置任务名时，**禁止将局部变量的地址赋值给任务名指针**
+ 任务栈的大小按照16字节或者 `sizeof(UINTPTR)*2` 对其，确定任务栈大小的原则是：
	+ 够用就行，多了浪费内存
	+ 少了会导致栈溢出问题
+ 挂起当前任务时，如果任务已经被锁定，则无法挂起
+ LDLE任务及软件定时器任务不能被挂起和删除
+ 在中断处理函数中或者在锁任务的情况下，执行 `LOS_TaskDelay()` 会失败
+ 锁任务调度，并不关中断，因此任务仍可以被中断打断
+ 锁任务调度必须和解锁人呢无调度配合使用
+ 设置任务优先级时可能会发生任务调度
+ 可配置的系统最大任务数是指：
	+ 整个系统的任务的总个数，并非用户能够使用的任务的个数
	+ 例如系统软件定时器多占用一个任务资源，那么用户能使用的任务资源就会减少一个
+ `LOS_TaskPriGet` 接口传入的 `task ID` 对应任务未创建或者超过最大任务数，统一返回 0xFFFF
+ 在删除任务时要保证任务申请的资源(如互斥锁、信号量等)已被释放
+ 在多核模式下，锁任务调度只能锁当前核的调度器，其他核仍能正常工作
+ 在多核模式下，由于跨核间任务的删除或者挂起是异步执行的
	+ 因此操作返回值并不代表最终的操作结果
	+ 只代表操作请求已经发出。
	+ 同时执行完成会存在延时
+ 在多核模式下，如果开启任务跨核删除同步的功能(LOSCFG_KERNEL_SMP_TASK_SYNC)
	+ 则跨核删除任务时，需要等待目标任务删除后才会返回结果
	+ 如果在设定时间内没有成功删除任务，则会返回 `LOS_ERRNO_TSK_MP_SYNC_FAILED` 错误
	+ 开启该功能后，每个任务会增加一个信号量的开销

## 实例
